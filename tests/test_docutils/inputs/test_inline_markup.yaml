citation_reference:
  - in:
      - '[citation]_'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <citation_reference ids="id1" refname="citation">'
      - '            citation'
  - in:
      - '[citation]_ and [cit-ation]_ and [cit.ation]_ and [CIT1]_ but not [CIT 1]_'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <citation_reference ids="id1" refname="citation">'
      - '            citation'
      - '         and '
      - '        <citation_reference ids="id2" refname="cit-ation">'
      - '            cit-ation'
      - '         and '
      - '        <citation_reference ids="id3" refname="cit.ation">'
      - '            cit.ation'
      - '         and '
      - '        <citation_reference ids="id4" refname="cit1">'
      - '            CIT1'
      - '         but not [CIT 1]_'
  - in:
      - 'Adjacent citation refs are not possible: [citation]_[CIT1]_'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Adjacent citation refs are not possible: [citation]_[CIT1]_'
embedded_URIs:
  - in:
      - '`phrase reference <http://example.com>`_'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="phrase reference" refuri="http://example.com">'
      - '            phrase reference'
      - '        <target ids="phrase-reference" names="phrase\ reference" refuri="http://example.com">'
  - in:
      - '`anonymous reference <http://example.com>`__'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="anonymous reference" refuri="http://example.com">'
      - '            anonymous reference'
  - in:
      - '`embedded URI on next line'
      - <http://example.com>`__
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="embedded URI on next line" refuri="http://example.com">'
      - '            embedded URI on next line'
  - in:
      - '`embedded URI across lines <http://example.com/'
      - long/path>`__
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="embedded URI across lines" refuri="http://example.com/long/path">'
      - '            embedded URI across lines'
  - in:
      - '`embedded URI with whitespace <http://example.com/'
      - long/path /and  /whitespace>`__
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="embedded URI with whitespace" refuri="http://example.com/long/path/and/whitespace">'
      - '            embedded URI with whitespace'
  - in:
      - ''
      - '`embedded URI with escaped whitespace <http://example.com/a\'
      - long/path\ and/some\ escaped\ whitespace>`__
      - ''
      - '`<omitted\ reference\ text\ with\ escaped\ whitespace>`__'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="embedded URI with escaped whitespace" refuri="http://example.com/a
        long/path and/some escaped whitespace">'
      - '            embedded URI with escaped whitespace'
      - '    <paragraph>'
      - '        <reference name="omitted reference text with escaped whitespace"
        refuri="omitted reference text with escaped whitespace">'
      - '            omitted reference text with escaped whitespace'
  - in:
      - '`embedded email address <jdoe@example.com>`__'
      - ''
      - '`embedded email address broken across lines <jdoe'
      - '@example.com>`__'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="embedded email address" refuri="mailto:jdoe@example.com">'
      - '            embedded email address'
      - '    <paragraph>'
      - '        <reference name="embedded email address broken across lines" refuri="mailto:jdoe@example.com">'
      - '            embedded email address broken across lines'
  - in:
      - ''
      - '`embedded URI with too much whitespace < http://example.com/'
      - long/path /and  /whitespace >`__
      - ''
      - '`embedded URI with too much whitespace at end <http://example.com/'
      - long/path /and  /whitespace >`__
      - ''
      - '`embedded URI with no preceding whitespace<http://example.com>`__'
      - ''
      - '`escaped URI \<http://example.com>`__'
      - ''
      - 'See `HTML Anchors: \<a>`_.'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference anonymous="1" name="embedded URI with too much whitespace
        < http://example.com/ long/path /and /whitespace >">'
      - '            embedded URI with too much whitespace < http://example.com/'
      - '            long/path /and  /whitespace >'
      - '    <paragraph>'
      - '        <reference anonymous="1" name="embedded URI with too much whitespace
        at end <http://example.com/ long/path /and /whitespace >">'
      - '            embedded URI with too much whitespace at end <http://example.com/'
      - '            long/path /and  /whitespace >'
      - '    <paragraph>'
      - '        <reference anonymous="1" name="embedded URI with no preceding whitespace<http://example.com>">'
      - '            embedded URI with no preceding whitespace<http://example.com>'
      - '    <paragraph>'
      - '        <reference anonymous="1" name="escaped URI <http://example.com>">'
      - '            escaped URI <http://example.com>'
      - '    <paragraph>'
      - '        See '
      - '        <reference name="HTML Anchors: <a>" refname="html anchors: <a>">'
      - '            HTML Anchors: <a>'
      - '        .'
  - in:
      - 'Relative URIs'' reference text can be omitted:'
      - ''
      - '`<reference>`_'
      - ''
      - '`<anonymous>`__'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Relative URIs'' reference text can be omitted:'
      - '    <paragraph>'
      - '        <reference name="reference" refuri="reference">'
      - '            reference'
      - '        <target ids="reference" names="reference" refuri="reference">'
      - '    <paragraph>'
      - '        <reference name="anonymous" refuri="anonymous">'
      - '            anonymous'
  - in:
      - ''
      - 'Escape trailing low-line char in URIs:'
      - ''
      - '`<reference\_>`_'
      - ''
      - '`<anonymous\_>`__'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Escape trailing low-line char in URIs:'
      - '    <paragraph>'
      - '        <reference name="reference_" refuri="reference_">'
      - '            reference_'
      - '        <target ids="reference" names="reference_" refuri="reference_">'
      - '    <paragraph>'
      - '        <reference name="anonymous_" refuri="anonymous_">'
      - '            anonymous_'
  - in:
      - 'Escape other char in URIs:'
      - ''
      - '`<reference\:1>`_'
      - ''
      - '`<anonymous\call>`__'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Escape other char in URIs:'
      - '    <paragraph>'
      - '        <reference name="reference:1" refuri="reference:1">'
      - '            reference:1'
      - '        <target ids="reference-1" names="reference:1" refuri="reference:1">'
      - '    <paragraph>'
      - '        <reference name="anonymouscall" refuri="anonymouscall">'
      - '            anonymouscall'
embedded_aliases:
  - in:
      - '`phrase reference <alias_>`_'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="phrase reference" refname="alias">'
      - '            phrase reference'
      - '        <target names="phrase\ reference" refname="alias">'
  - in:
      - '`anonymous reference <alias_>`__'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="anonymous reference" refname="alias">'
      - '            anonymous reference'
  - in:
      - '`embedded alias on next line'
      - <alias_>`__
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="embedded alias on next line" refname="alias">'
      - '            embedded alias on next line'
  - in:
      - '`embedded alias across lines <alias'
      - phrase_>`__
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="embedded alias across lines" refname="alias phrase">'
      - '            embedded alias across lines'
  - in:
      - '`embedded alias with whitespace <alias '
      - long  phrase_>`__
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="embedded alias with whitespace" refname="alias long
        phrase">'
      - '            embedded alias with whitespace'
  - in:
      - '`<embedded alias with whitespace_>`__'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="embedded alias with whitespace" refname="embedded
        alias with whitespace">'
      - '            embedded alias with whitespace'
  - in:
      - ''
      - '`no embedded alias (whitespace inside bracket) < alias_ >`__'
      - ''
      - '`no embedded alias (no preceding whitespace)<alias_>`__'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference anonymous="1" name="no embedded alias (whitespace inside
        bracket) < alias_ >">'
      - '            no embedded alias (whitespace inside bracket) < alias_ >'
      - '    <paragraph>'
      - '        <reference anonymous="1" name="no embedded alias (no preceding whitespace)<alias_>">'
      - '            no embedded alias (no preceding whitespace)<alias_>'
  - in:
      - ''
      - '`anonymous reference <alias\ with\\ escaped \:characters_>`__'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="anonymous reference" refname="aliaswith\ escaped
        :characters">'
      - '            anonymous reference'
  - in:
      - ''
      - '`anonymous reference <alias\ with\\ escaped \:characters_>`__'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="anonymous reference" refname="aliaswith\ escaped
        :characters">'
      - '            anonymous reference'
emphasis:
  - in:
      - '*emphasis*'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <emphasis>'
      - '            emphasis'
  - in:
      - l'*emphasis* with the *emphasis*' apostrophe.
      - "l\u2019*emphasis* with the *emphasis*\u2019 apostrophe."
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        l'''
      - '        <emphasis>'
      - '            emphasis'
      - '         with the '
      - '        <emphasis>'
      - '            emphasis'
      - '        '' apostrophe.'
      - "        l\u2019"
      - '        <emphasis>'
      - '            emphasis'
      - '         with the '
      - '        <emphasis>'
      - '            emphasis'
      - "        \u2019 apostrophe."
  - in:
      - '*emphasized sentence'
      - across lines*
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <emphasis>'
      - '            emphasized sentence'
      - '            across lines'
  - in:
      - '*emphasis without closing asterisk'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <problematic ids="id2" refid="id1">'
      - '            *'
      - '        emphasis without closing asterisk'
      - '    <system_message backrefs="id2" ids="id1" level="2" line="1" source="test
        data" type="WARNING">'
      - '        <paragraph>'
      - '            Inline emphasis start-string without end-string.'
  - in:
      - some punctuation is allowed around inline markup, e.g.
      - '/*emphasis*/, -*emphasis*-, and :*emphasis*: (delimiters),'
      - (*emphasis*), [*emphasis*], <*emphasis*>, {*emphasis*} (open/close pairs)
      - '*emphasis*., *emphasis*,, *emphasis*!, and *emphasis*\ (closing delimiters),'
      - ''
      - but not
      - )*emphasis*(, ]*emphasis*[, >*emphasis*>, }*emphasis*{ (close/open pairs),
      - (*), [*], '*' or '"*"' ("quoted" start-string),
      - x*2* or 2*x* (alphanumeric char before),
      - \*args or * (escaped, whitespace behind start-string),
      - or *the\* *stars\* *inside* (escaped, whitespace before end-string).
      - ''
      - However, '*args' will trigger a warning and may be problematic.
      - ''
      - what about *this**?
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        some punctuation is allowed around inline markup, e.g.'
      - '        /'
      - '        <emphasis>'
      - '            emphasis'
      - '        /, -'
      - '        <emphasis>'
      - '            emphasis'
      - '        -, and :'
      - '        <emphasis>'
      - '            emphasis'
      - '        : (delimiters),'
      - '        ('
      - '        <emphasis>'
      - '            emphasis'
      - '        ), ['
      - '        <emphasis>'
      - '            emphasis'
      - '        ], <'
      - '        <emphasis>'
      - '            emphasis'
      - '        >, {'
      - '        <emphasis>'
      - '            emphasis'
      - '        } (open/close pairs)'
      - '        <emphasis>'
      - '            emphasis'
      - '        ., '
      - '        <emphasis>'
      - '            emphasis'
      - '        ,, '
      - '        <emphasis>'
      - '            emphasis'
      - '        !, and '
      - '        <emphasis>'
      - '            emphasis'
      - '        (closing delimiters),'
      - '    <paragraph>'
      - '        but not'
      - '        )*emphasis*(, ]*emphasis*[, >*emphasis*>, }*emphasis*{ (close/open
        pairs),'
      - '        (*), [*], ''*'' or ''"*"'' ("quoted" start-string),'
      - '        x*2* or 2*x* (alphanumeric char before),'
      - '        *args or * (escaped, whitespace behind start-string),'
      - '        or '
      - '        <emphasis>'
      - '            the* *stars* *inside'
      - '         (escaped, whitespace before end-string).'
      - '    <paragraph>'
      - '        However, '''
      - '        <problematic ids="id2" refid="id1">'
      - '            *'
      - '        args'' will trigger a warning and may be problematic.'
      - '    <system_message backrefs="id2" ids="id1" level="2" line="13" source="test
        data" type="WARNING">'
      - '        <paragraph>'
      - '            Inline emphasis start-string without end-string.'
      - '    <paragraph>'
      - '        what about '
      - '        <emphasis>'
      - '            this*'
      - '        ?'
  - in:
      - 'Quotes around inline markup:'
      - ''
      - '''*emphasis*'' "*emphasis*" Straight,'
      - "\u2018*emphasis*\u2019 \u201C*emphasis*\u201D English, ...,"
      - "\xAB\u202F*emphasis*\u202F\xBB \u2039\u202F*emphasis*\u202F\u203A \xAB\_\
        *emphasis*\_\xBB \u2039\_*emphasis*\_\u203A"
      - "\xAB\u2005*emphasis*\u2005\xBB \u2039\u2005*emphasis*\u2005\u203A French,"
      - "\u201E*emphasis*\u201C \u201A*emphasis*\u2018 \xBB*emphasis*\xAB \u203A*emphasis*\u2039\
        \ German, Czech, ...,"
      - "\u201E*emphasis*\u201D \xAB*emphasis*\xBB Romanian,"
      - "\u201C*emphasis*\u201E \u2018*emphasis*\u201A Greek,"
      - "\u300C*emphasis*\u300D \u300E*emphasis*\u300Ftraditional Chinese,"
      - "\u201D*emphasis*\u201D \u2019*emphasis*\u2019 \xBB*emphasis*\xBB \u203A*emphasis*\u203A\
        \ Swedish, Finnish,"
      - "\u201E*emphasis*\u201D \u201A*emphasis*\u2019 Polish,"
      - "\u201E*emphasis*\u201D \xBB*emphasis*\xAB \u2019*emphasis*\u2019 Hungarian,"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Quotes around inline markup:'
      - '    <paragraph>'
      - '        '''
      - '        <emphasis>'
      - '            emphasis'
      - '        '' "'
      - '        <emphasis>'
      - '            emphasis'
      - '        " Straight,'
      - "        \u2018"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u2019 \u201C"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u201D English, ...,"
      - "        \xAB\u202F"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u202F\xBB \u2039\u202F"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u202F\u203A \xAB\_"
      - '        <emphasis>'
      - '            emphasis'
      - "        \_\xBB \u2039\_"
      - '        <emphasis>'
      - '            emphasis'
      - "        \_\u203A"
      - "        \xAB\u2005"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u2005\xBB \u2039\u2005"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u2005\u203A French,"
      - "        \u201E"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u201C \u201A"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u2018 \xBB"
      - '        <emphasis>'
      - '            emphasis'
      - "        \xAB \u203A"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u2039 German, Czech, ...,"
      - "        \u201E"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u201D \xAB"
      - '        <emphasis>'
      - '            emphasis'
      - "        \xBB Romanian,"
      - "        \u201C"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u201E \u2018"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u201A Greek,"
      - "        \u300C"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u300D \u300E"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u300Ftraditional Chinese,"
      - "        \u201D"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u201D \u2019"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u2019 \xBB"
      - '        <emphasis>'
      - '            emphasis'
      - "        \xBB \u203A"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u203A Swedish, Finnish,"
      - "        \u201E"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u201D \u201A"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u2019 Polish,"
      - "        \u201E"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u201D \xBB"
      - '        <emphasis>'
      - '            emphasis'
      - "        \xAB \u2019"
      - '        <emphasis>'
      - '            emphasis'
      - "        \u2019 Hungarian,"
  - in:
      - ''
      - 'Emphasized asterisk: *\**'
      - ''
      - 'Emphasized double asterisk: *\***'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Emphasized asterisk: '
      - '        <emphasis>'
      - '            *'
      - '    <paragraph>'
      - '        Emphasized double asterisk: '
      - '        <emphasis>'
      - '            **'
footnote_reference:
  - in:
      - '[1]_'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <footnote_reference ids="id1" refname="1">'
      - '            1'
  - in:
      - '[#]_'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <footnote_reference auto="1" ids="id1">'
  - in:
      - '[#label]_'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <footnote_reference auto="1" ids="id1" refname="label">'
  - in:
      - '[*]_'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <footnote_reference auto="*" ids="id1">'
  - in:
      - 'Adjacent footnote refs are not possible: [*]_[#label]_ [#]_[2]_ [1]_[*]_'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Adjacent footnote refs are not possible: [*]_[#label]_ [#]_[2]_ [1]_[*]_'
inline_targets:
  - in:
      - _`target`
      - ''
      - Here is _`another target` in some text. And _`yet
      - another target`, spanning lines.
      - ''
      - _`Here is  a    TaRgeT` with case and spacial difficulties.
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <target ids="target" names="target">'
      - '            target'
      - '    <paragraph>'
      - '        Here is '
      - '        <target ids="another-target" names="another\ target">'
      - '            another target'
      - '         in some text. And '
      - '        <target ids="yet-another-target" names="yet\ another\ target">'
      - '            yet'
      - '            another target'
      - '        , spanning lines.'
      - '    <paragraph>'
      - '        <target ids="here-is-a-target" names="here\ is\ a\ target">'
      - '            Here is  a    TaRgeT'
      - '         with case and spacial difficulties.'
  - in:
      - "l'_`target1` and l\u2019_`target2` with apostrophe"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        l'''
      - '        <target ids="target1" names="target1">'
      - '            target1'
      - "         and l\u2019"
      - '        <target ids="target2" names="target2">'
      - '            target2'
      - '         with apostrophe'
  - in:
      - quoted '_`target1`', quoted "_`target2`",
      - "quoted \u2018_`target3`\u2019, quoted \u201C_`target4`\u201D,"
      - "quoted \xAB_`target5`\xBB"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        quoted '''
      - '        <target ids="target1" names="target1">'
      - '            target1'
      - '        '', quoted "'
      - '        <target ids="target2" names="target2">'
      - '            target2'
      - '        ",'
      - "        quoted \u2018"
      - '        <target ids="target3" names="target3">'
      - '            target3'
      - "        \u2019, quoted \u201C"
      - '        <target ids="target4" names="target4">'
      - '            target4'
      - "        \u201D,"
      - "        quoted \xAB"
      - '        <target ids="target5" names="target5">'
      - '            target5'
      - "        \xBB"
  - in:
      - _`'target1'` with quotes, _`"target2"` with quotes,
      - "_`\u2018target3\u2019` with quotes, _`\u201Ctarget4\u201D` with quotes,"
      - "_`\xABtarget5\xBB` with quotes"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <target ids="target1" names="''target1''">'
      - '            ''target1'''
      - '         with quotes, '
      - '        <target ids="target2" names=""target2"">'
      - '            "target2"'
      - '         with quotes,'
      - "        <target ids=\"target3\" names=\"\u2018target3\u2019\">"
      - "            \u2018target3\u2019"
      - '         with quotes, '
      - "        <target ids=\"target4\" names=\"\u201Ctarget4\u201D\">"
      - "            \u201Ctarget4\u201D"
      - '         with quotes,'
      - "        <target ids=\"target5\" names=\"\xABtarget5\xBB\">"
      - "            \xABtarget5\xBB"
      - '         with quotes'
  - in:
      - But this isn't a _target; targets require backquotes.
      - ''
      - And _`this`_ is just plain confusing.
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        But this isn''t a _target; targets require backquotes.'
      - '    <paragraph>'
      - '        And '
      - '        <problematic ids="id2" refid="id1">'
      - '            _`'
      - '        this`_ is just plain confusing.'
      - '    <system_message backrefs="id2" ids="id1" level="2" line="3" source="test
        data" type="WARNING">'
      - '        <paragraph>'
      - '            Inline target start-string without end-string.'
  - in:
      - _`inline target without closing backquote
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <problematic ids="id2" refid="id1">'
      - '            _`'
      - '        inline target without closing backquote'
      - '    <system_message backrefs="id2" ids="id1" level="2" line="1" source="test
        data" type="WARNING">'
      - '        <paragraph>'
      - '            Inline target start-string without end-string.'
literal:
  - in:
      - '``literal``'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <literal>'
      - '            literal'
  - in:
      - ''
      - '``\literal``'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <literal>'
      - '            \literal'
  - in:
      - ''
      - '``lite\ral``'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <literal>'
      - '            lite\ral'
  - in:
      - ''
      - '``literal\``'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <literal>'
      - '            literal\'
  - in:
      - "l'``literal`` and l\u2019``literal`` with apostrophe"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        l'''
      - '        <literal>'
      - '            literal'
      - "         and l\u2019"
      - '        <literal>'
      - '            literal'
      - '         with apostrophe'
  - in:
      - quoted '``literal``', quoted "``literal``",
      - "quoted \u2018``literal``\u2019, quoted \u201C``literal``\u201D,"
      - "quoted \xAB``literal``\xBB"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        quoted '''
      - '        <literal>'
      - '            literal'
      - '        '', quoted "'
      - '        <literal>'
      - '            literal'
      - '        ",'
      - "        quoted \u2018"
      - '        <literal>'
      - '            literal'
      - "        \u2019, quoted \u201C"
      - '        <literal>'
      - '            literal'
      - "        \u201D,"
      - "        quoted \xAB"
      - '        <literal>'
      - '            literal'
      - "        \xBB"
  - in:
      - '``''literal''`` with quotes, ``"literal"`` with quotes,'
      - "``\u2018literal\u2019`` with quotes, ``\u201Cliteral\u201D`` with quotes,"
      - "``\xABliteral\xBB`` with quotes"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <literal>'
      - '            ''literal'''
      - '         with quotes, '
      - '        <literal>'
      - '            "literal"'
      - '         with quotes,'
      - '        <literal>'
      - "            \u2018literal\u2019"
      - '         with quotes, '
      - '        <literal>'
      - "            \u201Cliteral\u201D"
      - '         with quotes,'
      - '        <literal>'
      - "            \xABliteral\xBB"
      - '         with quotes'
  - in:
      - ''
      - '``literal ``TeX quotes'''' & \backslash`` but not "``" or ``'
      - ''
      - (however, ``standalone TeX quotes'' will trigger a warning
      - and may be problematic)
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <literal>'
      - '            literal ``TeX quotes'''' & \backslash'
      - '         but not "``" or ``'
      - '    <paragraph>'
      - '        (however, '
      - '        <problematic ids="id2" refid="id1">'
      - '            ``'
      - '        standalone TeX quotes'''' will trigger a warning'
      - '        and may be problematic)'
      - '    <system_message backrefs="id2" ids="id1" level="2" line="4" source="test
        data" type="WARNING">'
      - '        <paragraph>'
      - '            Inline literal start-string without end-string.'
  - in:
      - Find the ```interpreted text``` in this paragraph!
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Find the '
      - '        <literal>'
      - '            `interpreted text`'
      - '         in this paragraph!'
  - in:
      - '``literal without closing backquotes'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <problematic ids="id2" refid="id1">'
      - '            ``'
      - '        literal without closing backquotes'
      - '    <system_message backrefs="id2" ids="id1" level="2" line="1" source="test
        data" type="WARNING">'
      - '        <paragraph>'
      - '            Inline literal start-string without end-string.'
  - in:
      - ''
      - Python ``list``\s use square bracket syntax.
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Python '
      - '        <literal>'
      - '            list'
      - '        s use square bracket syntax.'
  - in:
      - ''
      - Blank after opening `` not allowed.
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Blank after opening `` not allowed.'
  - in:
      - ''
      - no blank ``after closing``continues`` literal.
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        no blank '
      - '        <literal>'
      - '            after closing``continues'
      - '         literal.'
  - in:
      - ''
      - dot ``after closing``. is possible.
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        dot '
      - '        <literal>'
      - '            after closing'
      - '        . is possible.'
markup recognition rules:
  - in:
      - __This__ should be left alone.
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        __This__ should be left alone.'
  - in:
      - ''
      - Character-level m\ *a*\ **r**\ ``k``\ `u`:title:\p
      - with backslash-escaped whitespace, including new\
      - lines.
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Character-level m'
      - '        <emphasis>'
      - '            a'
      - '        <strong>'
      - '            r'
      - '        <literal>'
      - '            k'
      - '        <title_reference>'
      - '            u'
      - '        p'
      - '        with backslash-escaped whitespace, including newlines.'
  - in:
      - "text-*separated*\u2010*by*\u2011*various*\u2012*dashes*\u2013*and*\u2014\
        *hyphens*."
      - "\xBF*punctuation*? \xA1*examples*!\_*no-break-space*\_."
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        text-'
      - '        <emphasis>'
      - '            separated'
      - "        \u2010"
      - '        <emphasis>'
      - '            by'
      - "        \u2011"
      - '        <emphasis>'
      - '            various'
      - "        \u2012"
      - '        <emphasis>'
      - '            dashes'
      - "        \u2013"
      - '        <emphasis>'
      - '            and'
      - "        \u2014"
      - '        <emphasis>'
      - '            hyphens'
      - '        .'
      - "        \xBF"
      - '        <emphasis>'
      - '            punctuation'
      - "        ? \xA1"
      - '        <emphasis>'
      - '            examples'
      - "        !\_"
      - '        <emphasis>'
      - '            no-break-space'
      - "        \_."
  - in:
      - text separated by
      - '*newline*'
      - or *space* or one of
      - "\_*NO-BREAK SPACE*\_,"
      - "\u1680*OGHAM SPACE MARK*\u1680,"
      - "\u2000*EN QUAD*\u2000,"
      - "\u2001*EM QUAD*\u2001,"
      - "\u2002*EN SPACE*\u2002,"
      - "\u2003*EM SPACE*\u2003,"
      - "\u2004*THREE-PER-EM SPACE*\u2004,"
      - "\u2005*FOUR-PER-EM SPACE*\u2005,"
      - "\u2006*SIX-PER-EM SPACE*\u2006,"
      - "\u2007*FIGURE SPACE*\u2007,"
      - "\u2008*PUNCTUATION SPACE*\u2008,"
      - "\u2009*THIN SPACE*\u2009,"
      - "\u200A*HAIR SPACE*\u200A,"
      - "\u202F*NARROW NO-BREAK SPACE*\u202F,"
      - "\u205F*MEDIUM MATHEMATICAL SPACE*\u205F,"
      - "\u3000*IDEOGRAPHIC SPACE*\u3000,"
      - ''
      - '*LINE SEPARATOR*'
      - ''
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        text separated by'
      - '        <emphasis>'
      - '            newline'
      - '        '
      - '        or '
      - '        <emphasis>'
      - '            space'
      - '         or one of'
      - "        \_"
      - '        <emphasis>'
      - '            NO-BREAK SPACE'
      - "        \_,"
      - "        \u1680"
      - '        <emphasis>'
      - '            OGHAM SPACE MARK'
      - "        \u1680,"
      - "        \u2000"
      - '        <emphasis>'
      - '            EN QUAD'
      - "        \u2000,"
      - "        \u2001"
      - '        <emphasis>'
      - '            EM QUAD'
      - "        \u2001,"
      - "        \u2002"
      - '        <emphasis>'
      - '            EN SPACE'
      - "        \u2002,"
      - "        \u2003"
      - '        <emphasis>'
      - '            EM SPACE'
      - "        \u2003,"
      - "        \u2004"
      - '        <emphasis>'
      - '            THREE-PER-EM SPACE'
      - "        \u2004,"
      - "        \u2005"
      - '        <emphasis>'
      - '            FOUR-PER-EM SPACE'
      - "        \u2005,"
      - "        \u2006"
      - '        <emphasis>'
      - '            SIX-PER-EM SPACE'
      - "        \u2006,"
      - "        \u2007"
      - '        <emphasis>'
      - '            FIGURE SPACE'
      - "        \u2007,"
      - "        \u2008"
      - '        <emphasis>'
      - '            PUNCTUATION SPACE'
      - "        \u2008,"
      - "        \u2009"
      - '        <emphasis>'
      - '            THIN SPACE'
      - "        \u2009,"
      - "        \u200A"
      - '        <emphasis>'
      - '            HAIR SPACE'
      - "        \u200A,"
      - "        \u202F"
      - '        <emphasis>'
      - '            NARROW NO-BREAK SPACE'
      - "        \u202F,"
      - "        \u205F"
      - '        <emphasis>'
      - '            MEDIUM MATHEMATICAL SPACE'
      - "        \u205F,"
      - "        \u3000"
      - '        <emphasis>'
      - '            IDEOGRAPHIC SPACE'
      - "        \u3000,"
      - '    <paragraph>'
      - '        <emphasis>'
      - '            LINE SEPARATOR'
  - in:
      - inline markup separated by non-ASCII whitespace
      - "\_**NO-BREAK SPACE**\_, \_``NO-BREAK SPACE``\_, \_`NO-BREAK SPACE`\_,"
      - "\u2000**EN QUAD**\u2000, \u2000``EN QUAD``\u2000, \u2000`EN QUAD`\u2000,"
      - "\u202F**NARROW NBSP**\u202F, \u202F``NARROW NBSP``\u202F, \u202F`NARROW NBSP`\u202F\
        ,"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        inline markup separated by non-ASCII whitespace'
      - "        \_"
      - '        <strong>'
      - '            NO-BREAK SPACE'
      - "        \_, \_"
      - '        <literal>'
      - '            NO-BREAK SPACE'
      - "        \_, \_"
      - '        <title_reference>'
      - '            NO-BREAK SPACE'
      - "        \_,"
      - "        \u2000"
      - '        <strong>'
      - '            EN QUAD'
      - "        \u2000, \u2000"
      - '        <literal>'
      - '            EN QUAD'
      - "        \u2000, \u2000"
      - '        <title_reference>'
      - '            EN QUAD'
      - "        \u2000,"
      - "        \u202F"
      - '        <strong>'
      - '            NARROW NBSP'
      - "        \u202F, \u202F"
      - '        <literal>'
      - '            NARROW NBSP'
      - "        \u202F, \u202F"
      - '        <title_reference>'
      - '            NARROW NBSP'
      - "        \u202F,"
  - in:
      - 'no inline markup due to whitespace inside and behind: *'
      - newline
      - '*'
      - '* space * or one of'
      - "*\_NO-BREAK SPACE\_*"
      - "*\u1680OGHAM SPACE MARK\u1680*"
      - "*\u2000EN QUAD\u2000*"
      - "*\u2001EM QUAD\u2001*"
      - "*\u2002EN SPACE\u2002*"
      - "*\u2003EM SPACE\u2003*"
      - "*\u2004THREE-PER-EM SPACE\u2004*"
      - "*\u2005FOUR-PER-EM SPACE\u2005*"
      - "*\u2006SIX-PER-EM SPACE\u2006*"
      - "*\u2007FIGURE SPACE\u2007*"
      - "*\u2008PUNCTUATION SPACE\u2008*"
      - "*\u2009THIN SPACE\u2009*"
      - "*\u200AHAIR SPACE\u200A*"
      - "*\u202FNARROW NO-BREAK SPACE\u202F*"
      - "*\u205FMEDIUM MATHEMATICAL SPACE\u205F*"
      - "*\u3000IDEOGRAPHIC SPACE\u3000*"
      - '*'
      - LINE SEPARATOR
      - '*'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        no inline markup due to whitespace inside and behind: *'
      - '        newline'
      - '        *'
      - '        * space * or one of'
      - "        *\_NO-BREAK SPACE\_*"
      - "        *\u1680OGHAM SPACE MARK\u1680*"
      - "        *\u2000EN QUAD\u2000*"
      - "        *\u2001EM QUAD\u2001*"
      - "        *\u2002EN SPACE\u2002*"
      - "        *\u2003EM SPACE\u2003*"
      - "        *\u2004THREE-PER-EM SPACE\u2004*"
      - "        *\u2005FOUR-PER-EM SPACE\u2005*"
      - "        *\u2006SIX-PER-EM SPACE\u2006*"
      - "        *\u2007FIGURE SPACE\u2007*"
      - "        *\u2008PUNCTUATION SPACE\u2008*"
      - "        *\u2009THIN SPACE\u2009*"
      - "        *\u200AHAIR SPACE\u200A*"
      - "        *\u202FNARROW NO-BREAK SPACE\u202F*"
      - "        *\u205FMEDIUM MATHEMATICAL SPACE\u205F*"
      - "        *\u3000IDEOGRAPHIC SPACE\u3000*"
      - '        *'
      - '        LINE SEPARATOR'
      - '        *'
  - in:
      - no inline markup because of non-ASCII whitespace following /preceding the
        markup
      - "**\_NO-BREAK SPACE\_** ``\_NO-BREAK SPACE\_`` `\_NO-BREAK SPACE\_`"
      - "**\u2000EN QUAD\u2000** ``\u2000EN QUAD\u2000`` `\u2000EN QUAD\u2000`"
      - "**\u202FNARROW NBSP\u202F** ``\u202FNARROW NBSP\u202F`` `\u202FNARROW NBSP\u202F\
        `"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        no inline markup because of non-ASCII whitespace following /preceding
        the markup'
      - "        **\_NO-BREAK SPACE\_** ``\_NO-BREAK SPACE\_`` `\_NO-BREAK SPACE\_\
        `"
      - "        **\u2000EN QUAD\u2000** ``\u2000EN QUAD\u2000`` `\u2000EN QUAD\u2000\
        `"
      - "        **\u202FNARROW NBSP\u202F** ``\u202FNARROW NBSP\u202F`` `\u202FNARROW\
        \ NBSP\u202F`"
  - in:
      - '"Quoted" markup start-string (matched openers & closers) -> no markup:'
      - ''
      - '''*'' "*" (*) <*> [*] {*}'
      - "\u2045*\u2046"
      - ''
      - 'Some international quoting styles:'
      - "\u2018*\u2019 \u201C*\u201D English, ...,"
      - "\u201E*\u201C \u201A*\u2018 \xBB*\xAB \u203A*\u2039 German, Czech, ...,"
      - "\u201E*\u201D \xAB*\xBB Romanian,"
      - "\u201C*\u201E \u2018*\u201A Greek,"
      - "\u300C*\u300D \u300E*\u300Ftraditional Chinese,"
      - "\u201D*\u201D \u2019*\u2019 \xBB*\xBB \u203A*\u203A Swedish, Finnish,"
      - "\u201E*\u201D \u201A*\u2019 Polish,"
      - "\u201E*\u201D \xBB*\xAB \u2019*\u2019 Hungarian,"
      - ''
      - "But this is \u201E*\u2019 emphasized \xBB*\u2039."
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        "Quoted" markup start-string (matched openers & closers) -> no markup:'
      - '    <paragraph>'
      - '        ''*'' "*" (*) <*> [*] {*}'
      - "        \u2045*\u2046"
      - '    <paragraph>'
      - '        Some international quoting styles:'
      - "        \u2018*\u2019 \u201C*\u201D English, ...,"
      - "        \u201E*\u201C \u201A*\u2018 \xBB*\xAB \u203A*\u2039 German, Czech,\
        \ ...,"
      - "        \u201E*\u201D \xAB*\xBB Romanian,"
      - "        \u201C*\u201E \u2018*\u201A Greek,"
      - "        \u300C*\u300D \u300E*\u300Ftraditional Chinese,"
      - "        \u201D*\u201D \u2019*\u2019 \xBB*\xBB \u203A*\u203A Swedish, Finnish,"
      - "        \u201E*\u201D \u201A*\u2019 Polish,"
      - "        \u201E*\u201D \xBB*\xAB \u2019*\u2019 Hungarian,"
      - '    <paragraph>'
      - "        But this is \u201E"
      - '        <emphasis>'
      - "            \u2019 emphasized \xBB"
      - "        \u2039."
phrase_references:
  - in:
      - '`phrase reference`_'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="phrase reference" refname="phrase reference">'
      - '            phrase reference'
  - in:
      - "l'`phrase reference`_ and l\u2019`phrase reference`_ with apostrophe"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        l'''
      - '        <reference name="phrase reference" refname="phrase reference">'
      - '            phrase reference'
      - "         and l\u2019"
      - '        <reference name="phrase reference" refname="phrase reference">'
      - '            phrase reference'
      - '         with apostrophe'
  - in:
      - quoted '`phrase reference`_', quoted "`phrase reference`_",
      - "quoted \u2018`phrase reference`_\u2019,"
      - "quoted \u201C`phrase reference`_\u201D,"
      - "quoted \xAB`phrase reference`_\xBB"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        quoted '''
      - '        <reference name="phrase reference" refname="phrase reference">'
      - '            phrase reference'
      - '        '', quoted "'
      - '        <reference name="phrase reference" refname="phrase reference">'
      - '            phrase reference'
      - '        ",'
      - "        quoted \u2018"
      - '        <reference name="phrase reference" refname="phrase reference">'
      - '            phrase reference'
      - "        \u2019,"
      - "        quoted \u201C"
      - '        <reference name="phrase reference" refname="phrase reference">'
      - '            phrase reference'
      - "        \u201D,"
      - "        quoted \xAB"
      - '        <reference name="phrase reference" refname="phrase reference">'
      - '            phrase reference'
      - "        \xBB"
  - in:
      - '`''phrase reference''`_ with quotes, `"phrase reference"`_ with quotes,'
      - "`\u2018phrase reference\u2019`_ with quotes,"
      - "`\u201Cphrase reference\u201D`_ with quotes,"
      - "`\xABphrase reference\xBB`_ with quotes"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="''phrase reference''" refname="''phrase reference''">'
      - '            ''phrase reference'''
      - '         with quotes, '
      - '        <reference name=""phrase reference"" refname=""phrase reference"">'
      - '            "phrase reference"'
      - '         with quotes,'
      - "        <reference name=\"\u2018phrase reference\u2019\" refname=\"\u2018\
        phrase reference\u2019\">"
      - "            \u2018phrase reference\u2019"
      - '         with quotes,'
      - "        <reference name=\"\u201Cphrase reference\u201D\" refname=\"\u201C\
        phrase reference\u201D\">"
      - "            \u201Cphrase reference\u201D"
      - '         with quotes,'
      - "        <reference name=\"\xABphrase reference\xBB\" refname=\"\xABphrase\
        \ reference\xBB\">"
      - "            \xABphrase reference\xBB"
      - '         with quotes'
  - in:
      - '`anonymous reference`__'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference anonymous="1" name="anonymous reference">'
      - '            anonymous reference'
  - in:
      - "l'`anonymous reference`__ and l\u2019`anonymous reference`__ with apostrophe"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        l'''
      - '        <reference anonymous="1" name="anonymous reference">'
      - '            anonymous reference'
      - "         and l\u2019"
      - '        <reference anonymous="1" name="anonymous reference">'
      - '            anonymous reference'
      - '         with apostrophe'
  - in:
      - quoted '`anonymous reference`__', quoted "`anonymous reference`__",
      - "quoted \u2018`anonymous reference`__\u2019,"
      - "quoted \u201C`anonymous reference`__\u201D,"
      - "quoted \xAB`anonymous reference`__\xBB"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        quoted '''
      - '        <reference anonymous="1" name="anonymous reference">'
      - '            anonymous reference'
      - '        '', quoted "'
      - '        <reference anonymous="1" name="anonymous reference">'
      - '            anonymous reference'
      - '        ",'
      - "        quoted \u2018"
      - '        <reference anonymous="1" name="anonymous reference">'
      - '            anonymous reference'
      - "        \u2019,"
      - "        quoted \u201C"
      - '        <reference anonymous="1" name="anonymous reference">'
      - '            anonymous reference'
      - "        \u201D,"
      - "        quoted \xAB"
      - '        <reference anonymous="1" name="anonymous reference">'
      - '            anonymous reference'
      - "        \xBB"
  - in:
      - '`''anonymous reference''`__ with quotes, `"anonymous reference"`__ with quotes,'
      - "`\u2018anonymous reference\u2019`__ with quotes,"
      - "`\u201Canonymous reference\u201D`__ with quotes,"
      - "`\xABanonymous reference\xBB`__ with quotes"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference anonymous="1" name="''anonymous reference''">'
      - '            ''anonymous reference'''
      - '         with quotes, '
      - '        <reference anonymous="1" name=""anonymous reference"">'
      - '            "anonymous reference"'
      - '         with quotes,'
      - "        <reference anonymous=\"1\" name=\"\u2018anonymous reference\u2019\
        \">"
      - "            \u2018anonymous reference\u2019"
      - '         with quotes,'
      - "        <reference anonymous=\"1\" name=\"\u201Canonymous reference\u201D\
        \">"
      - "            \u201Canonymous reference\u201D"
      - '         with quotes,'
      - "        <reference anonymous=\"1\" name=\"\xABanonymous reference\xBB\">"
      - "            \xABanonymous reference\xBB"
      - '         with quotes'
  - in:
      - '`phrase reference'
      - across lines`_
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="phrase reference across lines" refname="phrase reference
        across lines">'
      - '            phrase reference'
      - '            across lines'
  - in:
      - '`phrase\`_ reference`_'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="phrase`_ reference" refname="phrase`_ reference">'
      - '            phrase`_ reference'
  - in:
      - 'Invalid phrase reference:'
      - ''
      - :role:`phrase reference`_
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Invalid phrase reference:'
      - '    <paragraph>'
      - '        <problematic ids="id2" refid="id1">'
      - '            :role:`phrase reference`_'
      - '    <system_message backrefs="id2" ids="id1" level="2" line="3" source="test
        data" type="WARNING">'
      - '        <paragraph>'
      - '            Mismatch: both interpreted text role prefix and reference suffix.'
  - in:
      - 'Invalid phrase reference:'
      - ''
      - '`phrase reference`:role:_'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Invalid phrase reference:'
      - '    <paragraph>'
      - '        <problematic ids="id2" refid="id1">'
      - '            `phrase reference`:role:_'
      - '    <system_message backrefs="id2" ids="id1" level="2" line="3" source="test
        data" type="WARNING">'
      - '        <paragraph>'
      - '            Mismatch: both interpreted text role suffix and reference suffix.'
  - in:
      - '`phrase reference_ without closing backquote'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <problematic ids="id2" refid="id1">'
      - '            `'
      - '        phrase '
      - '        <reference name="reference" refname="reference">'
      - '            reference'
      - '         without closing backquote'
      - '    <system_message backrefs="id2" ids="id1" level="2" line="1" source="test
        data" type="WARNING">'
      - '        <paragraph>'
      - '            Inline interpreted text or phrase reference start-string without
        end-string.'
  - in:
      - '`anonymous phrase reference__ without closing backquote'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <problematic ids="id2" refid="id1">'
      - '            `'
      - '        anonymous phrase '
      - '        <reference anonymous="1" name="reference">'
      - '            reference'
      - '         without closing backquote'
      - '    <system_message backrefs="id2" ids="id1" level="2" line="1" source="test
        data" type="WARNING">'
      - '        <paragraph>'
      - '            Inline interpreted text or phrase reference start-string without
        end-string.'
references:
  - in:
      - ref_
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="ref" refname="ref">'
      - '            ref'
  - in:
      - "l'ref_ and l\u2019ref_ with apostrophe"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        l'''
      - '        <reference name="ref" refname="ref">'
      - '            ref'
      - "         and l\u2019"
      - '        <reference name="ref" refname="ref">'
      - '            ref'
      - '         with apostrophe'
  - in:
      - quoted 'ref_', quoted "ref_",
      - "quoted \u2018ref_\u2019, quoted \u201Cref_\u201D,"
      - "quoted \xABref_\xBB,"
      - "but not 'ref ref'_, \"ref ref\"_, \u2018ref ref\u2019_,"
      - "\u201Cref ref\u201D_, or \xABref ref\xBB_"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        quoted '''
      - '        <reference name="ref" refname="ref">'
      - '            ref'
      - '        '', quoted "'
      - '        <reference name="ref" refname="ref">'
      - '            ref'
      - '        ",'
      - "        quoted \u2018"
      - '        <reference name="ref" refname="ref">'
      - '            ref'
      - "        \u2019, quoted \u201C"
      - '        <reference name="ref" refname="ref">'
      - '            ref'
      - "        \u201D,"
      - "        quoted \xAB"
      - '        <reference name="ref" refname="ref">'
      - '            ref'
      - "        \xBB,"
      - "        but not 'ref ref'_, \"ref ref\"_, \u2018ref ref\u2019_,"
      - "        \u201Cref ref\u201D_, or \xABref ref\xBB_"
  - in:
      - ref__
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference anonymous="1" name="ref">'
      - '            ref'
  - in:
      - "l'ref__ and l\u2019ref__ with apostrophe"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        l'''
      - '        <reference anonymous="1" name="ref">'
      - '            ref'
      - "         and l\u2019"
      - '        <reference anonymous="1" name="ref">'
      - '            ref'
      - '         with apostrophe'
  - in:
      - quoted 'ref__', quoted "ref__",
      - "quoted \u2018ref__\u2019, quoted \u201Cref__\u201D,"
      - "quoted \xABref__\xBB,"
      - "but not 'ref ref'__, \"ref ref\"__, \u2018ref ref\u2019__,"
      - "\u201Cref ref\u201D__, or \xABref ref\xBB__"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        quoted '''
      - '        <reference anonymous="1" name="ref">'
      - '            ref'
      - '        '', quoted "'
      - '        <reference anonymous="1" name="ref">'
      - '            ref'
      - '        ",'
      - "        quoted \u2018"
      - '        <reference anonymous="1" name="ref">'
      - '            ref'
      - "        \u2019, quoted \u201C"
      - '        <reference anonymous="1" name="ref">'
      - '            ref'
      - "        \u201D,"
      - "        quoted \xAB"
      - '        <reference anonymous="1" name="ref">'
      - '            ref'
      - "        \xBB,"
      - "        but not 'ref ref'__, \"ref ref\"__, \u2018ref ref\u2019__,"
      - "        \u201Cref ref\u201D__, or \xABref ref\xBB__"
  - in:
      - ref_, r_, r_e-f_, -ref_, and anonymousref__,
      - but not _ref_ or __attr__ or object.__attr__
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference name="ref" refname="ref">'
      - '            ref'
      - '        , '
      - '        <reference name="r" refname="r">'
      - '            r'
      - '        , '
      - '        <reference name="r_e-f" refname="r_e-f">'
      - '            r_e-f'
      - '        , -'
      - '        <reference name="ref" refname="ref">'
      - '            ref'
      - '        , and '
      - '        <reference anonymous="1" name="anonymousref">'
      - '            anonymousref'
      - '        ,'
      - '        but not _ref_ or __attr__ or object.__attr__'
standalone_hyperlink:
  - in:
      - http://www.standalone.hyperlink.com
      - ''
      - http:/one-slash-only.absolute.path
      - ''
      - '[http://example.com]'
      - ''
      - (http://example.com)
      - ''
      - <http://example.com>
      - ''
      - http://[1080:0:0:0:8:800:200C:417A]/IPv6address.html
      - ''
      - http://[3ffe:2a00:100:7031::1] (the final "]" is ambiguous in text)
      - ''
      - http://[3ffe:2a00:100:7031::1]/
      - ''
      - mailto:someone@somewhere.com
      - ''
      - news:comp.lang.python
      - ''
      - 'An email address in a sentence: someone@somewhere.com.'
      - ''
      - ftp://ends.with.a.period.
      - ''
      - (a.question.mark@end?)
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference refuri="http://www.standalone.hyperlink.com">'
      - '            http://www.standalone.hyperlink.com'
      - '    <paragraph>'
      - '        <reference refuri="http:/one-slash-only.absolute.path">'
      - '            http:/one-slash-only.absolute.path'
      - '    <paragraph>'
      - '        ['
      - '        <reference refuri="http://example.com">'
      - '            http://example.com'
      - '        ]'
      - '    <paragraph>'
      - '        ('
      - '        <reference refuri="http://example.com">'
      - '            http://example.com'
      - '        )'
      - '    <paragraph>'
      - '        <'
      - '        <reference refuri="http://example.com">'
      - '            http://example.com'
      - '        >'
      - '    <paragraph>'
      - '        <reference refuri="http://[1080:0:0:0:8:800:200C:417A]/IPv6address.html">'
      - '            http://[1080:0:0:0:8:800:200C:417A]/IPv6address.html'
      - '    <paragraph>'
      - '        <reference refuri="http://[3ffe:2a00:100:7031::1">'
      - '            http://[3ffe:2a00:100:7031::1'
      - '        ] (the final "]" is ambiguous in text)'
      - '    <paragraph>'
      - '        <reference refuri="http://[3ffe:2a00:100:7031::1]/">'
      - '            http://[3ffe:2a00:100:7031::1]/'
      - '    <paragraph>'
      - '        <reference refuri="mailto:someone@somewhere.com">'
      - '            mailto:someone@somewhere.com'
      - '    <paragraph>'
      - '        <reference refuri="news:comp.lang.python">'
      - '            news:comp.lang.python'
      - '    <paragraph>'
      - '        An email address in a sentence: '
      - '        <reference refuri="mailto:someone@somewhere.com">'
      - '            someone@somewhere.com'
      - '        .'
      - '    <paragraph>'
      - '        <reference refuri="ftp://ends.with.a.period">'
      - '            ftp://ends.with.a.period'
      - '        .'
      - '    <paragraph>'
      - '        ('
      - '        <reference refuri="mailto:a.question.mark@end">'
      - '            a.question.mark@end'
      - '        ?)'
  - in:
      - ''
      - 'Valid URLs with escaped markup characters:'
      - ''
      - http://example.com/\*content\*/whatever
      - ''
      - http://example.com/\*content*/whatever
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Valid URLs with escaped markup characters:'
      - '    <paragraph>'
      - '        <reference refuri="http://example.com/*content*/whatever">'
      - '            http://example.com/*content*/whatever'
      - '    <paragraph>'
      - '        <reference refuri="http://example.com/*content*/whatever">'
      - '            http://example.com/*content*/whatever'
  - in:
      - 'Valid URLs may end with punctuation inside "<>":'
      - ''
      - <http://example.org/ends-with-dot.>
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Valid URLs may end with punctuation inside "<>":'
      - '    <paragraph>'
      - '        <'
      - '        <reference refuri="http://example.org/ends-with-dot.">'
      - '            http://example.org/ends-with-dot.'
      - '        >'
  - in:
      - 'Valid URLs with interesting endings:'
      - ''
      - http://example.org/ends-with-pluses++
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Valid URLs with interesting endings:'
      - '    <paragraph>'
      - '        <reference refuri="http://example.org/ends-with-pluses++">'
      - '            http://example.org/ends-with-pluses++'
  - in:
      - None of these are standalone hyperlinks (their "schemes"
      - 'are not recognized): signal:noise, a:b.'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        None of these are standalone hyperlinks (their "schemes"'
      - '        are not recognized): signal:noise, a:b.'
  - in:
      - 'Escaped email addresses are not recognized: test\@example.org'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Escaped email addresses are not recognized: test@example.org'
strong:
  - in:
      - '**strong**'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <strong>'
      - '            strong'
  - in:
      - "l'**strong** and l\u2019**strong** with apostrophe"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        l'''
      - '        <strong>'
      - '            strong'
      - "         and l\u2019"
      - '        <strong>'
      - '            strong'
      - '         with apostrophe'
  - in:
      - quoted '**strong**', quoted "**strong**",
      - "quoted \u2018**strong**\u2019, quoted \u201C**strong**\u201D,"
      - "quoted \xAB**strong**\xBB"
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        quoted '''
      - '        <strong>'
      - '            strong'
      - '        '', quoted "'
      - '        <strong>'
      - '            strong'
      - '        ",'
      - "        quoted \u2018"
      - '        <strong>'
      - '            strong'
      - "        \u2019, quoted \u201C"
      - '        <strong>'
      - '            strong'
      - "        \u201D,"
      - "        quoted \xAB"
      - '        <strong>'
      - '            strong'
      - "        \xBB"
  - in:
      - ''
      - (**strong**) but not (**) or '(** ' or x**2 or \**kwargs or **
      - ''
      - (however, '**kwargs' will trigger a warning and may be problematic)
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        ('
      - '        <strong>'
      - '            strong'
      - '        ) but not (**) or ''(** '' or x**2 or **kwargs or **'
      - '    <paragraph>'
      - '        (however, '''
      - '        <problematic ids="id2" refid="id1">'
      - '            **'
      - '        kwargs'' will trigger a warning and may be problematic)'
      - '    <system_message backrefs="id2" ids="id1" level="2" line="4" source="test
        data" type="WARNING">'
      - '        <paragraph>'
      - '            Inline strong start-string without end-string.'
  - in:
      - 'Strong asterisk: *****'
      - ''
      - 'Strong double asterisk: ******'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        Strong asterisk: '
      - '        <strong>'
      - '            *'
      - '    <paragraph>'
      - '        Strong double asterisk: '
      - '        <strong>'
      - '            **'
  - in:
      - '**strong without closing asterisks'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <problematic ids="id2" refid="id1">'
      - '            **'
      - '        strong without closing asterisks'
      - '    <system_message backrefs="id2" ids="id1" level="2" line="1" source="test
        data" type="WARNING">'
      - '        <paragraph>'
      - '            Inline strong start-string without end-string.'
substitution_references:
  - in:
      - '|subref|'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <substitution_reference refname="subref">'
      - '            subref'
  - in:
      - '|subref|_ and |subref|__'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <reference refname="subref">'
      - '            <substitution_reference refname="subref">'
      - '                subref'
      - '         and '
      - '        <reference anonymous="1">'
      - '            <substitution_reference refname="subref">'
      - '                subref'
  - in:
      - '|substitution reference|'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <substitution_reference refname="substitution reference">'
      - '            substitution reference'
  - in:
      - '|substitution'
      - reference|
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <substitution_reference refname="substitution reference">'
      - '            substitution'
      - '            reference'
  - in:
      - '|substitution reference without closing verbar'
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        <problematic ids="id2" refid="id1">'
      - '            |'
      - '        substitution reference without closing verbar'
      - '    <system_message backrefs="id2" ids="id1" level="2" line="1" source="test
        data" type="WARNING">'
      - '        <paragraph>'
      - '            Inline substitution_reference start-string without end-string.'
  - in:
      - first | then || and finally |||
    out:
      - <document source="test data">
      - '    <paragraph>'
      - '        first | then || and finally |||'
